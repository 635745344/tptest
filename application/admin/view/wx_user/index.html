<style>
    .content_h2{
        border:none;
        font-weight:400;
    }
    .content_box_classify{
        width:70%;
        height:auto;
        border-top:2px solid #418BB8;
        background-color:#fff;
        float:left;
    }
    .content_box_right{
        width:29%;
        float:right;
        background-color:#fff;
        border-top:2px solid #00A65A;
    }
    .content_classify_title{
        width:100%;
        height:54px;
    }
    .form-control{
        float:left;
        width:100%;
        border-color:#DEE1E7;
        outline:none;
    }
    .input-grounp{
        margin-top:8px;
    }
    .input-grounp span {
        position:absolute;
        top:1px;
        right:16px;
        display:inline-block;
        background-color:#fff;
        width:28px;
        height:32px;
        border:none;
        outline:none;
        cursor:pointer;
        line-height:32px;
        padding-left:4px;
    }
    .classify_title{
        color:#949596;
        line-height:54px;
        font-size:18px;
        margin-left:10px;
    }
    .content_box_right ul{
        width:100%;
        height:400px;
    }
    .content_box_right ul li{
        line-height:38px;
        padding-left:15px;
        cursor:pointer;
    }
    .content_box_right ul li.adminAtor{
        background-color:#F7F7F7;
    }
    #classifyTable{
        position:relative;
        width:100%;
        height:auto;
        left:0;
        top:-2px;
    }
    #operation{
        position:absolute;
        top:2px;
        left:50px;
        width:80%;
        height:38px;
        z-index:100;
    }
    table{
        border:none;
    }
   #operation td{
        float:left;
        padding:5px 15px;
        margin:4px 10px;
        background:#F4F4F4;
        border:1px solid #bbb;
        border-radius:4px;
        cursor:pointer;
    }
    #operation td:hover{
        color:#009688;
    }
   .layui-table-cell{
       height:100%;
   }
    .layui-table-body{
        overflow-x:hidden;
    }
    .layui-table-body tbody tr{
        height:70px;
    }
    #layer-form{
        width:100%;
        height:auto;
        background-color:#ffff;
        border:1px solid #DADEE2;
        padding:10px 0 20px 0;
    }
    #layer-form .layui-form .layui-input-block{
        width:98%;
        margin:10px auto 0;
        padding-left:5px;
    }
    .layui-input-block span{
        -webkit-touch-callout: none; /* iOS Safari */

        -webkit-user-select: none; /* Chrome/Safari/Opera */

        -khtml-user-select: none; /* Konqueror */

        -moz-user-select: none; /* Firefox */

        -ms-user-select: none; /* Internet Explorer/Edge */

        user-select: none; /* Non-prefixed version, currently

        not supported by any browser */
    }
    #layer-form .layui-form input{
        margin-right:5px;
        float:left;
    }
    #layer-form .layui-form-item{
        width:75%;
        margin:10px auto 0;
    }
    #layer-form .layui-form-item button{
        border:none;
        background:#00C0EF;
        padding:5px 30px;
        color:#fff;
        border-radius:5px;
        float:left;
    }
    #layer-form .layui-form-item button.cancal{
        float:right;
        background:#CCCCCC;
    }
    .layui-form-label{
        padding:0;
        text-align:center;
        width:90px;
    }
    .layui-form-label span{
        font-size:18px;
    }
    .layui-form-label .admin{
        color:#73B9FF;
    }
    .layui-form-label .retail{
        color:#FF7373;
    }
    .layui-form-label .mainten{
        color:#FFA64D;
    }
    .layui-form-label i{
        color:#BCC5C8;
        margin-right:6px;
        font-size:18px;
        cursor:pointer;
    }
    .layui-table, .layui-table-view{
        margin:0;
    }
    @font-face {font-family: "iconfont";
        src: url('iconfont.eot?t=1524016064514'); /* IE9*/
        src: url('iconfont.eot?t=1524016064514#iefix') format('embedded-opentype'), /* IE6-IE8 */
        url('data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAWUAAsAAAAACDwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7klJY21hcAAAAYAAAABnAAABnNBybsRnbHlmAAAB6AAAAasAAAH4i70IuGhlYWQAAAOUAAAALwAAADYRGM19aGhlYQAAA8QAAAAcAAAAJAfeA4VobXR4AAAD4AAAABAAAAAQD+kAAGxvY2EAAAPwAAAACgAAAAoBcgCwbWF4cAAAA/wAAAAfAAAAIAETAF1uYW1lAAAEHAAAAUUAAAJtPlT+fXBvc3QAAAVkAAAALwAAAEgG2ECFeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2Bk/sU4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVDyPZW7438AQw9zA0AAUZgTJAQAq/QzMeJzFkMEJwCAMRX+MLVI6So+l24jQU0dwYh3DJtGLE/jlmeQTjATABoCFS/AAfSCoXnHJfMZhvscjdZDjJOaSamxtylRkHcEypy/TjmWidaNnnXbfo9J954F8saSO7rXGDvgHAKcSZwB4nFWQz27TQBDG99v1ehM3sfH/xGniOKHZ0gRLmJBQVSQXWslVD0iISkFRVR4Arr1w8KUSBw48A0JC4pxTVfESPAGC17DLUi50tdpvZr/faDRDOCE3P9k1axGX7JJH5Dl5QQj0MQYm7SKR05SO4SfcDz2TyaFMxHCQsmcIB7oXZLPpKNSFbsFED4+TbCZTKvFkuqAHyIIu0O5EL52dbYd9gtGSvcvqmH6GHw+3rcXDKp8svazv1i4ajtN2nI81nfMapZpl4m0Y1Hnd0Ksv3Ir86/gBjdFoy+hk1ex3nDcfpu+6O2EdKAq4nb75dWlHtrrvo8B12uJes9aKmsP7Hi5+b7XcRnf0i6hD1ayFRlhBLBITwpMU0l5gnvQQ2ibUEMJWYaK+bGWx1+VJvgbWOb06XFGsSzbZB/Yn9EopP5gUf63NP6Q8Olyx78osj3bnt9BGQXd7jtVmk7tNGPSBRIrpbImFWlmMIJtjlin12KvyND+n9Dyn3271aXUqPHFDNM61Pc0QBtuoHGfq2ROsUOD/BdWPaqTrqLMtBUrGObtU6ZkQY8MnfwAJdVLPAHicY2BkYGAA4i3Pxb3i+W2+MnCzMIDAtT9HDiDo/w0sDMwNQC4HAxNIFABeVQxpAHicY2BkYGBu+N/AEMPCAAJAkpEBFbAAAEcKAm0EAAAAA+kAAAQAAAAEAAAAAAAAAAB2ALAA/AAAeJxjYGRgYGBhCGRgZQABJiDmAkIGhv9gPgMAERIBcQB4nGWPTU7DMBCFX/oHpBKqqGCH5AViASj9EatuWFRq911036ZOmyqJI8et1ANwHo7ACTgC3IA78EgnmzaWx9+8eWNPANzgBx6O3y33kT1cMjtyDRe4F65TfxBukF+Em2jjVbhF/U3YxzOmwm10YXmD17hi9oR3YQ8dfAjXcI1P4Tr1L+EG+Vu4iTv8CrfQ8erCPuZeV7iNRy/2x1YvnF6p5UHFockikzm/gple75KFrdLqnGtbxCZTg6BfSVOdaVvdU+zXQ+ciFVmTqgmrOkmMyq3Z6tAFG+fyUa8XiR6EJuVYY/62xgKOcQWFJQ6MMUIYZIjK6Og7VWb0r7FDwl57Vj3N53RbFNT/c4UBAvTPXFO6stJ5Ok+BPV8bUnV0K27LnpQ0kV7NSRKyQl7WtlRC6gE2ZVeOEXpc0Yk/KGdI/wAJWm7IAAAAeJxjYGKAAC4G7ICFkYmRmZGFkZWBsYKnPDWzojQxryojPy+duxLBZmAAAKW3Cp4A') format('woff'),
        url('iconfont.ttf?t=1524016064514') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+*/
        url('iconfont.svg?t=1524016064514#iconfont') format('svg'); /* iOS 4.1- */
    }

    .iconfont {
        font-family:"iconfont" !important;
        font-size:16px;
        font-style:normal;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .icon-weixuanzhong:before { content: "\e65f"; }

    .icon-yixuanzhong:before { content: "\e75d"; }
    .layui-table-page div{
        float:right;
    }
</style>
<div class="content_box clearfix">
    <h2 class="content_h2">人员管理</h2>
    <div class="content_box_classify">
        <div class="content_classify_title">
            <span class="pull-left classify_title">用户整理归类</span>
            <div class="input-grounp pull-right col-xs-4">
                <input type="text" class="form-control" placeholder="用户昵称" id="searchInput">
                <span id="search">
                        <i class="glyphicon glyphicon-search"></i>
                </span>
            </div>
        </div>
        <table  id="classifyTable" lay-filter="classify">
            <tr id="operation">
                   <!-- <td class="joinAdmin">加入管理员</td>-->
                    <td class="joinMainten">加入维护员</td>
                   <!-- <td class="joinRetail">加入零售户</td>-->
            </tr>
        </table>
    </div>
    <div class="content_box_right">
        <ul>
            <li  class="allAtor li-item">全部用户<span></span></li>
            <li user_group_id="2"class="li-item adminAtor">管理员<span></span></li>
            <li user_group_id="3" class="li-item maintenAtor">维护员<span></span></li>
            <li user_group_id="4"class="li-item retailAtor">零售户<span></span></li>
            <li user_group_id="1"class="li-item ungroupAtor">未分组<span></span></li>
        </ul>
    </div>
</div>
<!--<div id="layer-form">
    <form  class="layui-form">
        <div class="layui-input-block">
            <label  class="layui-form-label" value=2><i class="iconfont icon-weixuanzhong"></i><span class="admin">管理员</span></label>
            <label  class="layui-form-label" value=4><i class="iconfont icon-weixuanzhong" ></i><span class="retail">零售户</span></label>
            <label  class="layui-form-label" value=3><i class="iconfont icon-weixuanzhong" ></i><span class="mainten">维护员</span></label>
        </div>
        <div class="layui-form-item">
            <button class="confirm">确认</button>
            <button class="cancal">取消</button>
        </div>
    </form>
</div>-->
<script type="text/html" id="classifyTpl">
    {{#  if(d.user_group_id === 1){ }}
    {{#  if(d.headimgurl !==""){ }}
    <img src="{{d.headimgurl}}" style='float:left; width:50px;height:50px;border-radius:50%;margin-right:30px;'alt="">
    {{#  } else{ }}
    <img src="/static/image/admin/default.jpg" style='float:left; width:50px;height:50px;border-radius:50%;margin-right:30px;'alt="">
    {{#  } }}
    <ul style="float:left;">
        <li style="line-height:25px;color:#333333;text-align:left;">{{d.nickname}}</li>
        <li style="width:68px;line-height:25px;color:#999999;text-align:left;">未分组 <span lay-event="edit" class="btn-permission" style="float:right;width:0;height:0;border:8px solid transparent;border-top:8px solid #BBBBBB;margin:8px 0 0 0;cursor:pointer;"></span></li>
    </ul>
    {{#  } else if(d.user_group_id === 2){ }}
    {{#  if(d.headimgurl !==""){ }}
    <img src="{{d.headimgurl}}" style='float:left; width:50px;height:50px;border-radius:50%;margin-right:30px;'alt="">
    {{#  } else{ }}
    <img src="/plugin/static/img/default.jpg" style='float:left; width:50px;height:50px;border-radius:50%;margin-right:30px;'alt="">
    {{#  } }}
    <ul style="float:left;">
        <li style="line-height:25px;color:#333333;text-align:left;">{{d.nickname}}</li>
        <li style="width:68px;line-height:25px;color:#73B9FF;text-align:left;">管理员 <span lay-event="edit" class="btn-permission" style="float:right;width:0;height:0;border:8px solid transparent;border-top:8px solid #BBBBBB;margin:8px 0 0 0;cursor:pointer;"></span></li>
    </ul>
    {{#  } else if(d.user_group_id === 3){ }}
    {{#  if(d.headimgurl !==""){ }}
    <img src="{{d.headimgurl}}" style='float:left; width:50px;height:50px;border-radius:50%;margin-right:30px;'alt="">
    {{#  } else{ }}
    <img src="/static/image/admin/default.jpg" style='float:left; width:50px;height:50px;border-radius:50%;margin-right:30px;'alt="">
    {{#  } }}
    <ul style="float:left;">
        <li style="line-height:25px;color:#333333;text-align:left;">{{d.nickname}}</li>
        <li style="width:68px;line-height:25px;color:#FFBC79;text-align:left;">维护员 <span lay-event="edit" class="btn-permission" style="float:right;width:0;height:0;border:8px solid transparent;border-top:8px solid #BBBBBB;margin:8px 0 0 0;cursor:pointer;"></span></li>
    </ul>
    {{#  } else if(d.user_group_id === 4){ }}
    {{#  if(d.headimgurl !==""){ }}
    <img src="{{d.headimgurl}}" style='float:left; width:50px;height:50px;border-radius:50%;margin-right:30px;'alt="">
    {{#  } else{ }}
    <img src="/static/image/admin/default.jpg" style='float:left; width:50px;height:50px;border-radius:50%;margin-right:30px;'alt="">
    {{#  } }}
    <ul style="float:left;">
        <li style="line-height:25px;color:#333333;text-align:left;">{{d.nickname}}</li>
        <li style="width:68px;line-height:25px;color:#FF7373;text-align:left;">零售户<span lay-event="edit" class="btn-permission" style="float:right;width:0;height:0;border:8px solid transparent;border-top:8px solid #BBBBBB;margin:8px 0 0 0;cursor:pointer;"></span></li>
    </ul>
    {{# } }}
</script>
<script>
    $(function(){
       layer.load(3,{shade:0.6,content:"正在加载"});
        var useId =null;//用户编号
        //填充右边数据
        paddingData();
        function paddingData() {
            var group ={$group};
            var all_count ='{$all_count}';
            for(var i=0;i<group.length;i++){
                if(group[i].id==2){
                    $(".content_box_right .adminAtor").find("span").text("("+group[i].count+")");
                }else if(group[i].id==3){
                    $(".content_box_right .maintenAtor").find("span").text("("+group[i].count+")");
                }else if(group[i].id==4){
                    $(".content_box_right .retailAtor").find("span").text("("+group[i].count+")");
                }else if(group[i].id==1){
                    $(".content_box_right .ungroupAtor").find("span").text("("+group[i].count+")");
                }
            }
            $(".content_box_right .allAtor").find("span").text("("+all_count+")");
        }

        layui.use('table', function(){
            var table = layui.table;

            table.render({
                elem: '#classifyTable'
                ,url:'/admin/WxUser/lists'
                ,cols: [[
                    {type:'checkbox'}
                    ,{field:'nickname', width:'100%', title: '  ',align:'left',toolbar:'#classifyTpl'}
                ]]
                ,page: {layout:false,groups:5,heme:'#367AB7',first:false
                    ,last:false,prev:'<button><</button>',next:'<button>></button>',
                }
                ,id:"information"
                ,method:'post'
                ,response:{
                statusName:'status',
                    statusCode:1,
            },
                done:function(res,curr,count){
                    layer.closeAll();
                }
            });
            //右侧重载
            $(".content_box_right ul .li-item").on("click",function(){
                var user_group_id = $(this).attr("user_group_id");
                table.reload("information",{
                    url:"/admin/WxUser/lists",page:{curr:1},where:{"user_group_id":user_group_id}
                })

            })
            //表格重载
            function reload(){
                table.reload("information",{
                    url:"/admin/WxUser/lists",page:{curr:1}
                })
            }
            //搜索用户昵称
            $(".input-grounp").on("click","#search",function(){
                if($("#searchInput").val()!=null&&$("#searchInput").val()!=""&&$("#searchInput").val()!=undefined){
                table.reload("information",{
                    url:"/admin/WxUser/lists",page:{curr:1},where:{"nickname":$("#searchInput").val()}
                })
                }else{
                    layer.msg("请输入要搜索的昵称");
                }
            })
            $("input.form-control").keyup(function(event){
                if(event.keyCode==13){
                    table.reload("information",{
                        url:"/admin/WxUser/lists",page:{curr:1},where:{"nickname":$("#searchInput").val()}
                    })
                }
            })
            //事件监听
            table.on('tool(classify)',function(obj){
                var data = obj.data;
                if(obj.event=='edit'){
                    userId =data.id;
                }
            })
            function joinOrigan(team,teamId){
                var checkStatus = table.checkStatus('information');
                var data =checkStatus.data;
                var user_id ="";
                var user_name="";
                if(data.length<=0){
                    layer.msg("请选择加入人员");
                    return;
                }else{
                    for(var p in data){
                        user_id=user_id+data[p].id+",";
                        user_name=user_name+data[p].nickname+",";
                    }
                    user_id =user_id.substring(0,user_id.length-1);
                    user_name = user_name.substring(0,user_name.length-1);

                    layer.confirm("确定将"+user_name+"加入"+team+"?",{icon:9},function(index){
                        $.ajax({
                            type:"post",
                            dataType:"json",
                            data:{"user_id":user_id,"user_group_id":teamId},
                            url:"/admin/WxUser/updateUserGroup",
                            success:function(respone){
                                if(respone.status==1){
                                    reload();
                                    prompt("加入成功",4000);
                                }
                            }

                        })
                    })
                }
            }
            /*//加入未分组
             $("#operation").on("click",".joinAdmin",function(){
                 joinOrigan("管理员",1);
             })*/
            //加入管理员
           /* $("#operation").on("click",".joinAdmin",function(){
                joinOrigan("管理员",2);
            })*/
            //加入维护员
            $("#operation").on("click",".joinMainten",function(){
                joinOrigan("维护员",3);
            })
            //加入零售户
           /* $("#operation").on("click",".joinRetail",function(){
                joinOrigan("零售户",4);
            })*/
            //确定修改
            $("body").on("click","#layer-form .confirm",function(){
                var checked =$("#layer-form i.icon-yixuanzhong");
                if(checked.length>0){
                    $.ajax({
                        type:"post",
                        dataType:"json",
                        data:{"user_id":userId,"user_group_id":checked.parent().attr("value")},
                        url:"/admin/WxUser/updateUserGroup",
                        success:function(result){
                            if(result.status==1){
                                //reload();
                                //prompt(result.info,4000);
                                layer.open({
                                    title:false,
                                    btnAlign:"c",
                                    closeBtn:0,
                                    content:"<p style='text-align:center;font-size:18px;'>"+result.info+"</p>",
                                    time:4000,
                                    shade:0.6,
                                    end:function(){
                                        //reload();
                                        layer.closeAll();
                                        history.go(0);
                                    }

                                })

                            }
                        }
                    })
                }else{
                    layer.msg("请先选择分组");
                }
            })
        });
        /*var flag=true;*/
        $(".content_box_classify").on("click",".layui-table-body .btn-permission",function(){
          /*  if(flag){*/
          if($("#layer-form").css("display")=="block"){
              return;
          }else{
            layer.open({
                type: 1
                ,area: ['300px', '118px']
                ,title: false
                ,shade: 0 //遮罩透明度
                ,anim: 1 //0-6的动画形式，-1不开启
                ,closeBtn:0
                /*,end:function(){
                    flag=true;
                }*/
                ,content:'<div id="layer-form">\n' +
                '    <form  class="layui-form">\n' +
                '        <div class="layui-input-block">\n' +
             /*               <label  class="layui-form-label" value=2><i class="iconfont icon-weixuanzhong"></i><span class="admin">管理员</span></label>\n' +
                '           <label  class="layui-form-label" value=4><i class="iconfont icon-weixuanzhong" ></i><span class="retail">零售户</span></label>\n' + */
                '            <label  class="layui-form-label" value=3><i class="iconfont icon-weixuanzhong" ></i><span class="mainten">维护员</span></label>\n' +
                '<label  class="layui-form-label" value=1><i class="iconfont icon-weixuanzhong" ></i><span class="retail">未分组</span></label>\n'+
                '        </div>\n' +
                '        <div class="layui-form-item">\n' +
                '            <button class="confirm">确认</button>\n' +
                '            <button class="cancal">取消</button>\n' +
                '        </div>\n' +
                '    </form>\n' +
                '</div>'
            });
            }
        })
       $("body").on("click","#layer-form .iconfont",function(){
           if($(this).hasClass("icon-weixuanzhong")){
               $(this).removeClass("icon-weixuanzhong").addClass("icon-yixuanzhong").parent().siblings().find(".iconfont").removeClass("icon-yixuanzhong").addClass("icon-weixuanzhong");
           }else{
               $(this).removeClass("icon-yixuanzhong").addClass("icon-weixuanzhong");
           }
       })


        $("body").on("click","#layer-form .cancal",function(){
            layer.closeAll();
        })

        //提示
        function prompt(text,time){
            layer.open({
                title:false,
                btnAlign:"c",
                content:"<p style='text-align:center;font-size:18px;'>"+text+"</p>",
                time:time||6000,
                shade:0.6,
                end:function(){
                    history.go(0);
                    layer.closeAll();
                }

            })
        }
    })
</script>